<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive kindergarten math practice - Sign in to save progress or continue as guest">
    <meta name="author" content="Kindergarten Math App">
    <meta name="theme-color" content="#4a90e2">
    
    <title>Welcome - Kindergarten Math</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* Landing page specific styles */
        .landing-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, #5aa3f0 100%);
            padding: 2rem;
        }
        
        .landing-card {
            background: var(--bg-color);
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 3rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .landing-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .landing-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .landing-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            line-height: 1.6;
        }
        
        .landing-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .landing-btn {
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        
        .landing-btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .landing-btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.3);
        }
        
        .landing-btn-secondary {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .landing-btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }
        
        .landing-btn-guest {
            background: var(--bg-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .landing-btn-guest:hover {
            color: var(--text-color);
            border-color: var(--text-secondary);
        }
        
        .landing-features {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .landing-feature {
            text-align: center;
            flex: 1;
        }
        
        .landing-feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .landing-feature-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        @media (max-width: 640px) {
            .landing-card {
                padding: 2rem;
                margin: 1rem;
            }
            
            .landing-title {
                font-size: 2rem;
            }
            
            .landing-subtitle {
                font-size: 1rem;
            }
            
            .landing-features {
                flex-direction: column;
                gap: 1rem;
            }
            
            .landing-btn {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }
        }
        
        /* Dark theme support */
        [data-theme="dark"] .landing-container {
            background: linear-gradient(135deg, #2d3436 0%, #1a1a1a 100%);
        }
        
        [data-theme="dark"] .landing-card {
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="landing-container">
        <div class="landing-card">
            <div class="landing-logo">üßÆ</div>
            <h1 class="landing-title">Kindergarten Math</h1>
            <p class="landing-subtitle">
                Practice arithmetic with interactive exercises designed for young learners
            </p>
            
            <div class="landing-features">
                <div class="landing-feature">
                    <div class="landing-feature-icon">‚ûï</div>
                    <div class="landing-feature-text">Addition & Subtraction</div>
                </div>
                <div class="landing-feature">
                    <div class="landing-feature-icon">‚úñÔ∏è</div>
                    <div class="landing-feature-text">Multiplication & Division</div>
                </div>
                <div class="landing-feature">
                    <div class="landing-feature-icon">üéØ</div>
                    <div class="landing-feature-text">Progress Tracking</div>
                </div>
            </div>
            
            <div class="landing-actions">
                <button class="landing-btn landing-btn-primary" id="landing-signin">
                    üîê Sign In
                </button>
                <button class="landing-btn landing-btn-secondary" id="landing-signup">
                    ‚ú® Create Account
                </button>
                <button class="landing-btn landing-btn-guest" id="landing-guest">
                    üë§ Continue as Guest
                </button>
            </div>
            
            <div style="margin-top: 2rem; font-size: 0.85rem; color: var(--text-secondary);">
                <p><strong>Signed in users:</strong> Save progress, track statistics, sync across devices</p>
                <p><strong>Guest mode:</strong> Practice immediately, no registration required</p>
            </div>
        </div>
    </div>

    <!-- Authentication Modal (reused from main app) -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="auth-modal-close" id="close-auth-modal">&times;</span>
            
            <!-- Login Form -->
            <div id="login-form-container" class="auth-form-container">
                <h2>Sign In</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <div id="login-error" class="error-message"></div>
                    <button type="submit">Sign In</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-register">Don't have an account? Sign up</a>
                    <a href="#" id="switch-to-forgot">Forgot password?</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="register-form-container" class="auth-form-container">
                <h2>Create Account</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-email">Email:</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password:</label>
                        <input type="password" id="register-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirm Password:</label>
                        <input type="password" id="register-confirm-password" required minlength="6">
                    </div>
                    <div id="register-error" class="error-message"></div>
                    <button type="submit">Create Account</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-login">Already have an account? Sign in</a>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgot-form-container" class="auth-form-container">
                <h2>Reset Password</h2>
                <form id="forgot-form">
                    <div class="form-group">
                        <label for="forgot-email">Email:</label>
                        <input type="email" id="forgot-email" required>
                    </div>
                    <div id="forgot-error" class="error-message"></div>
                    <button type="submit">Send Reset Email</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-login">Back to sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script>
        // Landing page authentication handler
        class LandingAuth {
            constructor() {
                this.initializeAuth();
                this.bindEvents();
            }
            
            async initializeAuth() {
                // Load authentication system
                if (typeof window.APP_CONFIG === 'undefined') {
                    console.error('APP_CONFIG not found');
                    return;
                }
                
                // Initialize Supabase if needed
                if (typeof window.supabase === 'undefined') {
                    await this.loadSupabaseScript();
                }
                
                this.supabase = window.supabase.createClient(
                    window.APP_CONFIG.supabase.url,
                    window.APP_CONFIG.supabase.anonKey
                );
                
                // Check if user is already authenticated
                this.checkExistingAuth();
            }
            
            async loadSupabaseScript() {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            async checkExistingAuth() {
                try {
                    const { data: { user } } = await this.supabase.auth.getUser();
                    if (user) {
                        // User is already logged in, go directly to app
                        this.redirectToApp(true);
                    }
                } catch (error) {
                    console.log('No existing auth found');
                }
            }
            
            bindEvents() {
                // Landing page buttons
                document.getElementById('landing-signin')?.addEventListener('click', () => {
                    this.showAuthModal('login');
                });
                
                document.getElementById('landing-signup')?.addEventListener('click', () => {
                    this.showAuthModal('register');
                });
                
                document.getElementById('landing-guest')?.addEventListener('click', () => {
                    this.redirectToApp(false);
                });
                
                // Auth modal events
                document.getElementById('close-auth-modal')?.addEventListener('click', () => {
                    this.hideAuthModal();
                });
                
                // Auth form events
                document.getElementById('login-form')?.addEventListener('submit', (e) => {
                    this.handleLogin(e);
                });
                
                document.getElementById('register-form')?.addEventListener('submit', (e) => {
                    this.handleRegister(e);
                });
                
                // Form switching
                document.getElementById('switch-to-register')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('register');
                });
                
                document.getElementById('switch-to-login')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('login');
                });
            }
            
            showAuthModal(type) {
                const modal = document.getElementById('auth-modal');
                const forms = ['login-form-container', 'register-form-container', 'forgot-form-container'];
                
                // Hide all forms
                forms.forEach(formId => {
                    const form = document.getElementById(formId);
                    if (form) form.style.display = 'none';
                });
                
                // Show selected form
                const selectedForm = document.getElementById(`${type}-form-container`);
                if (selectedForm) {
                    selectedForm.style.display = 'block';
                    modal.style.display = 'flex';
                }
            }
            
            hideAuthModal() {
                const modal = document.getElementById('auth-modal');
                if (modal) modal.style.display = 'none';
                this.clearErrors();
            }
            
            async handleLogin(event) {
                event.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                try {
                    const { data, error } = await this.supabase.auth.signInWithPassword({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    // Success - redirect to app
                    this.redirectToApp(true);
                    
                } catch (error) {
                    this.showError('login', error.message);
                }
            }
            
            async handleRegister(event) {
                event.preventDefault();
                
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                if (password !== confirmPassword) {
                    this.showError('register', 'Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('register', 'Password must be at least 6 characters');
                    return;
                }
                
                try {
                    const { data, error } = await this.supabase.auth.signUp({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    alert('Registration successful! Please check your email to verify your account, then sign in.');
                    this.showAuthModal('login');
                    
                } catch (error) {
                    this.showError('register', error.message);
                }
            }
            
            showError(formType, message) {
                const errorDiv = document.getElementById(`${formType}-error`);
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                }
            }
            
            clearErrors() {
                const errorDivs = document.querySelectorAll('[id$="-error"]');
                errorDivs.forEach(div => {
                    div.style.display = 'none';
                    div.textContent = '';
                });
            }
            
            redirectToApp(isAuthenticated) {
                // Store auth state for the main app
                sessionStorage.setItem('authMode', isAuthenticated ? 'authenticated' : 'guest');
                
                // Redirect to main app
                window.location.href = 'app.html';
            }
        }
        
        // Initialize landing auth when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new LandingAuth();
        });
        
        // Theme support
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved theme or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });
    </script>
</body>
</html>