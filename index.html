<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive kindergarten math practice - Sign in to save progress or continue as guest">
    <meta name="author" content="Kindergarten Math App">
    <meta name="theme-color" content="#2a2a2a">
    
    <title>Welcome - Kindergarten Math</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* Landing page specific styles - Minimal black & gray theme
           Design preference: Use shades of black/gray, minimal text/graphics */
        :root {
            --landing-bg: #1a1a1a;
            --landing-card-bg: #2a2a2a;
            --landing-text: #ffffff;
            --landing-text-secondary: #b0b0b0;
            --landing-border: #404040;
            --landing-btn-primary: #f5f5f5;
            --landing-btn-secondary: #b0b0b0;
            --landing-hover: #ffffff;
        }
        
        [data-theme="light"] {
            --landing-bg: #f5f5f5;
            --landing-card-bg: #ffffff;
            --landing-text: #1a1a1a;
            --landing-text-secondary: #666666;
            --landing-border: #e0e0e0;
            --landing-btn-primary: #2a2a2a;
            --landing-btn-secondary: #666666;
            --landing-hover: #000000;
        }
        
        .landing-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--landing-bg);
            padding: 2rem;
        }
        
        .landing-card {
            background: var(--landing-card-bg);
            border: 1px solid var(--landing-border);
            border-radius: 0.5rem;
            padding: 3rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .landing-title {
            font-size: 2rem;
            font-weight: 400;
            color: var(--landing-text);
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }
        
        .landing-subtitle {
            font-size: 0.95rem;
            color: var(--landing-text-secondary);
            margin-bottom: 2.5rem;
            font-weight: 300;
        }
        
        .landing-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .landing-btn {
            padding: 0.875rem 1.5rem;
            border-radius: 0.25rem;
            font-size: 0.95rem;
            font-weight: 400;
            text-decoration: none;
            transition: all 0.15s ease;
            cursor: pointer;
            border: 1px solid var(--landing-border);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .landing-btn-primary {
            background: var(--landing-btn-primary);
            color: var(--landing-card-bg);
            border-color: var(--landing-btn-primary);
        }
        
        .landing-btn-primary:hover {
            background: var(--landing-hover);
            border-color: var(--landing-hover);
        }
        
        .landing-btn-secondary {
            background: transparent;
            color: var(--landing-btn-secondary);
            border-color: var(--landing-btn-secondary);
        }
        
        .landing-btn-secondary:hover {
            background: var(--landing-btn-secondary);
            color: var(--landing-card-bg);
        }
        
        .landing-btn-guest {
            background: transparent;
            color: var(--landing-text-secondary);
            border-color: var(--landing-border);
            font-size: 0.9rem;
        }
        
        .landing-btn-guest:hover {
            background: var(--landing-bg);
        }
        
        .landing-info {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--landing-border);
            font-size: 0.85rem;
            color: var(--landing-text-secondary);
            line-height: 1.4;
        }
        
        @media (max-width: 640px) {
            .landing-card {
                padding: 2rem;
                margin: 1rem;
                max-width: 350px;
            }
            
            .landing-title {
                font-size: 1.75rem;
            }
            
            .landing-btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="landing-container">
        <div class="landing-card">
            <h1 class="landing-title">Kindergarten Math</h1>
            
            <div class="landing-actions">
                <button class="landing-btn landing-btn-primary" id="landing-signin">
                    Sign In
                </button>
                <button class="landing-btn landing-btn-secondary" id="landing-signup">
                    Create Account
                </button>
                <button class="landing-btn landing-btn-guest" id="landing-guest">
                    Continue as Guest
                </button>
            </div>
            
            <div class="landing-info">
                Guests have temporary progress only.
            </div>
        </div>
    </div>

    <!-- Authentication Modal (reused from main app) -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="auth-modal-close" id="close-auth-modal">&times;</span>
            
            <!-- Login Form -->
            <div id="login-form-container" class="auth-form-container">
                <h2>Sign In</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <div id="login-error" class="error-message"></div>
                    <button type="submit">Sign In</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-register">Don't have an account? Sign up</a>
                    <a href="#" id="switch-to-forgot">Forgot password?</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="register-form-container" class="auth-form-container">
                <h2>Create Account</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-email">Email:</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password:</label>
                        <input type="password" id="register-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirm Password:</label>
                        <input type="password" id="register-confirm-password" required minlength="6">
                    </div>
                    <div id="register-error" class="error-message"></div>
                    <button type="submit">Create Account</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-login">Already have an account? Sign in</a>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgot-form-container" class="auth-form-container">
                <h2>Reset Password</h2>
                <form id="forgot-form">
                    <div class="form-group">
                        <label for="forgot-email">Email:</label>
                        <input type="email" id="forgot-email" required>
                    </div>
                    <div id="forgot-error" class="error-message"></div>
                    <button type="submit">Send Reset Email</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="switch-to-login">Back to sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script>
        // Landing page authentication handler
        class LandingAuth {
            constructor() {
                this.initializeAuth();
                this.bindEvents();
            }
            
            async initializeAuth() {
                // Load authentication system
                if (typeof window.APP_CONFIG === 'undefined') {
                    console.error('APP_CONFIG not found');
                    return;
                }
                
                // Initialize Supabase if needed
                if (typeof window.supabase === 'undefined') {
                    await this.loadSupabaseScript();
                }
                
                this.supabase = window.supabase.createClient(
                    window.APP_CONFIG.supabase.url,
                    window.APP_CONFIG.supabase.anonKey
                );
                
                // Check if user is already authenticated
                this.checkExistingAuth();
            }
            
            async loadSupabaseScript() {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            async checkExistingAuth() {
                try {
                    const { data: { user } } = await this.supabase.auth.getUser();
                    if (user) {
                        // User is already logged in, go directly to app
                        this.redirectToApp(true);
                    }
                } catch (error) {
                    console.log('No existing auth found');
                }
            }
            
            bindEvents() {
                // Landing page buttons
                document.getElementById('landing-signin')?.addEventListener('click', () => {
                    this.showAuthModal('login');
                });
                
                document.getElementById('landing-signup')?.addEventListener('click', () => {
                    this.showAuthModal('register');
                });
                
                document.getElementById('landing-guest')?.addEventListener('click', () => {
                    this.redirectToApp(false);
                });
                
                // Auth modal events
                document.getElementById('close-auth-modal')?.addEventListener('click', () => {
                    this.hideAuthModal();
                });
                
                // Auth form events
                document.getElementById('login-form')?.addEventListener('submit', (e) => {
                    this.handleLogin(e);
                });
                
                document.getElementById('register-form')?.addEventListener('submit', (e) => {
                    this.handleRegister(e);
                });
                
                // Form switching
                document.getElementById('switch-to-register')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('register');
                });
                
                document.getElementById('switch-to-login')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('login');
                });
            }
            
            showAuthModal(type) {
                const modal = document.getElementById('auth-modal');
                const forms = ['login-form-container', 'register-form-container', 'forgot-form-container'];
                
                // Hide all forms
                forms.forEach(formId => {
                    const form = document.getElementById(formId);
                    if (form) form.style.display = 'none';
                });
                
                // Show selected form
                const selectedForm = document.getElementById(`${type}-form-container`);
                if (selectedForm) {
                    selectedForm.style.display = 'block';
                    modal.style.display = 'flex';
                }
            }
            
            hideAuthModal() {
                const modal = document.getElementById('auth-modal');
                if (modal) modal.style.display = 'none';
                this.clearErrors();
            }
            
            async handleLogin(event) {
                event.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                try {
                    const { data, error } = await this.supabase.auth.signInWithPassword({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    // Success - redirect to app
                    this.redirectToApp(true);
                    
                } catch (error) {
                    this.showError('login', error.message);
                }
            }
            
            async handleRegister(event) {
                event.preventDefault();
                
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                if (password !== confirmPassword) {
                    this.showError('register', 'Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('register', 'Password must be at least 6 characters');
                    return;
                }
                
                try {
                    const { data, error } = await this.supabase.auth.signUp({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    alert('Registration successful! Please check your email to verify your account, then sign in.');
                    this.showAuthModal('login');
                    
                } catch (error) {
                    this.showError('register', error.message);
                }
            }
            
            showError(formType, message) {
                const errorDiv = document.getElementById(`${formType}-error`);
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                }
            }
            
            clearErrors() {
                const errorDivs = document.querySelectorAll('[id$="-error"]');
                errorDivs.forEach(div => {
                    div.style.display = 'none';
                    div.textContent = '';
                });
            }
            
            redirectToApp(isAuthenticated) {
                // Store auth state for the main app
                sessionStorage.setItem('authMode', isAuthenticated ? 'authenticated' : 'guest');
                
                // Redirect to main app
                window.location.href = 'pages/arithmetic.html';
            }
        }
        
        // Initialize landing auth when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new LandingAuth();
        });
        
        // Theme support
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved theme or default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });
    </script>
</body>
</html>