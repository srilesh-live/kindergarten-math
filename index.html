<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive kindergarten math practice - Sign in to save progress or continue as guest">
    <meta name="author" content="Kindergarten Math App">
    <meta name="theme-color" content="#1f2937">
    
    <title>Welcome - Kindergarten Math</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#6b7280',
                        background: '#111827',
                        surface: '#1f2937',
                        'surface-light': '#374151'
                    },
                    fontFamily: {
                        'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    <!-- Minimal custom CSS for specific overrides -->
    <style>
        .material-icons {
            font-size: inherit;
            line-height: inherit;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen bg-background text-white font-sans overflow-hidden">
    <!-- Landing Page with Perfect Centering -->
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-surface border border-gray-700 rounded-2xl p-8 md:p-10 shadow-2xl backdrop-blur-sm w-full max-w-md transform -translate-y-8 md:-translate-y-4">
            <!-- Title -->
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-8 text-white tracking-tight">
                Kindergarten Math
            </h1>
            
            <!-- Action Buttons -->
            <div class="space-y-3 mb-6">
                <button 
                    id="landing-signin"
                    class="w-full bg-white text-gray-900 font-semibold py-4 px-6 rounded-xl hover:bg-gray-100 transform hover:-translate-y-0.5 transition-all duration-200 shadow-lg hover:shadow-xl"
                >
                    Sign In
                </button>
                
                <button 
                    id="landing-signup"
                    class="w-full bg-transparent text-gray-300 font-semibold py-4 px-6 rounded-xl border-2 border-gray-600 hover:bg-gray-600 hover:text-white transform hover:-translate-y-0.5 transition-all duration-200"
                >
                    Create Account
                </button>
                
                <button 
                    id="landing-guest"
                    class="w-full bg-transparent text-gray-400 font-medium py-3 px-6 rounded-xl hover:bg-gray-800 hover:text-gray-200 transition-all duration-200 text-sm"
                >
                    Continue as Guest
                </button>
            </div>
            
            <!-- Guest Info -->
            <div class="pt-6 border-t border-gray-700 text-center text-sm text-gray-400 leading-relaxed">
                Sign In for AI-driven insights & statistics
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-surface border border-gray-700 rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
            <div class="flex justify-end p-4">
                <button id="close-auth-modal" class="text-gray-400 hover:text-gray-200 text-2xl font-bold w-8 h-8 flex items-center justify-center hover:bg-gray-700 rounded-lg transition-colors">
                    &times;
                </button>
            </div>
            
            <!-- Login Form -->
            <div id="login-form-container" class="p-6 pt-0">
                <h2 class="text-2xl font-bold text-white text-center mb-6">Sign In</h2>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-300 mb-2">Email:</label>
                        <input 
                            type="email" 
                            id="login-email" 
                            required
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Enter your email"
                        >
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-300 mb-2">Password:</label>
                        <input 
                            type="password" 
                            id="login-password" 
                            required
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Enter your password"
                        >
                    </div>
                    <div id="login-error" class="text-red-400 text-sm"></div>
                    <button 
                        type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                        Sign In
                    </button>
                </form>
                <div class="mt-6 space-y-2 text-center">
                    <a href="#" id="switch-to-register" class="block text-sm text-blue-400 hover:text-blue-300 transition-colors">
                        Don't have an account? Sign up
                    </a>
                    <a href="#" id="switch-to-forgot" class="block text-sm text-gray-400 hover:text-gray-300 transition-colors">
                        Forgot password?
                    </a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="register-form-container" class="p-6 pt-0 hidden">
                <h2 class="text-2xl font-bold text-white text-center mb-6">Create Account</h2>
                <form id="register-form" class="space-y-4">
                    <div>
                        <label for="register-email" class="block text-sm font-medium text-gray-300 mb-2">Email:</label>
                        <input 
                            type="email" 
                            id="register-email" 
                            required
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Enter your email"
                        >
                    </div>
                    <div>
                        <label for="register-password" class="block text-sm font-medium text-gray-300 mb-2">Password:</label>
                        <input 
                            type="password" 
                            id="register-password" 
                            required 
                            minlength="6"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Minimum 6 characters"
                        >
                    </div>
                    <div>
                        <label for="register-confirm-password" class="block text-sm font-medium text-gray-300 mb-2">Confirm Password:</label>
                        <input 
                            type="password" 
                            id="register-confirm-password" 
                            required 
                            minlength="6"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Confirm your password"
                        >
                    </div>
                    <div id="register-error" class="text-red-400 text-sm"></div>
                    <button 
                        type="submit"
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                        Create Account
                    </button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="switch-to-login" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">
                        Already have an account? Sign in
                    </a>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgot-form-container" class="p-6 pt-0 hidden">
                <h2 class="text-2xl font-bold text-white text-center mb-6">Reset Password</h2>
                <form id="forgot-form" class="space-y-4">
                    <div>
                        <label for="forgot-email" class="block text-sm font-medium text-gray-300 mb-2">Email:</label>
                        <input 
                            type="email" 
                            id="forgot-email" 
                            required
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Enter your email address"
                        >
                    </div>
                    <div id="forgot-error" class="text-red-400 text-sm"></div>
                    <button 
                        type="submit"
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                        Send Reset Email
                    </button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="switch-to-login" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">
                        Back to sign in
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script>
        // Landing page authentication handler
        class LandingAuth {
            constructor() {
                this.initializeAuth();
                this.bindEvents();
            }
            
            async initializeAuth() {
                // Load authentication system
                if (typeof window.APP_CONFIG === 'undefined') {
                    console.error('APP_CONFIG not found');
                    return;
                }
                
                // Initialize Supabase if needed
                if (typeof window.supabase === 'undefined') {
                    await this.loadSupabaseScript();
                }
                
                this.supabase = window.supabase.createClient(
                    window.APP_CONFIG.supabase.url,
                    window.APP_CONFIG.supabase.anonKey
                );
                
                // Check if user is already authenticated
                this.checkExistingAuth();
            }
            
            async loadSupabaseScript() {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            async checkExistingAuth() {
                try {
                    const { data: { user } } = await this.supabase.auth.getUser();
                    if (user) {
                        // User is already logged in, go directly to app
                        this.redirectToApp(true);
                    }
                } catch (error) {
                    console.log('No existing auth found');
                }
            }
            
            bindEvents() {
                // Landing page buttons
                document.getElementById('landing-signin')?.addEventListener('click', () => {
                    this.showAuthModal('login');
                });
                
                document.getElementById('landing-signup')?.addEventListener('click', () => {
                    this.showAuthModal('register');
                });
                
                document.getElementById('landing-guest')?.addEventListener('click', () => {
                    this.redirectToApp(false);
                });
                
                // Auth modal events
                document.getElementById('close-auth-modal')?.addEventListener('click', () => {
                    this.hideAuthModal();
                });
                
                // Auth form events
                document.getElementById('login-form')?.addEventListener('submit', (e) => {
                    this.handleLogin(e);
                });
                
                document.getElementById('register-form')?.addEventListener('submit', (e) => {
                    this.handleRegister(e);
                });
                
                // Form switching
                document.getElementById('switch-to-register')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('register');
                });
                
                document.getElementById('switch-to-login')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthModal('login');
                });
            }
            
            showAuthModal(type) {
                const modal = document.getElementById('auth-modal');
                const forms = ['login-form-container', 'register-form-container', 'forgot-form-container'];
                
                // Hide all forms
                forms.forEach(formId => {
                    const form = document.getElementById(formId);
                    if (form) form.style.display = 'none';
                });
                
                // Show selected form
                const selectedForm = document.getElementById(`${type}-form-container`);
                if (selectedForm) {
                    selectedForm.style.display = 'block';
                    modal.style.display = 'flex';
                }
            }
            
            hideAuthModal() {
                const modal = document.getElementById('auth-modal');
                if (modal) modal.style.display = 'none';
                this.clearErrors();
            }
            
            async handleLogin(event) {
                event.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                try {
                    const { data, error } = await this.supabase.auth.signInWithPassword({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    // Success - redirect to app
                    this.redirectToApp(true);
                    
                } catch (error) {
                    this.showError('login', error.message);
                }
            }
            
            async handleRegister(event) {
                event.preventDefault();
                
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                if (password !== confirmPassword) {
                    this.showError('register', 'Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('register', 'Password must be at least 6 characters');
                    return;
                }
                
                try {
                    const { data, error } = await this.supabase.auth.signUp({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    window.ModalSystem?.showAlert('Registration successful! Please check your email to verify your account, then sign in.', 'Registration Complete');
                    this.showAuthModal('login');
                    
                } catch (error) {
                    this.showError('register', error.message);
                }
            }
            
            showError(formType, message) {
                const errorDiv = document.getElementById(`${formType}-error`);
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                }
            }
            
            clearErrors() {
                const errorDivs = document.querySelectorAll('[id$="-error"]');
                errorDivs.forEach(div => {
                    div.style.display = 'none';
                    div.textContent = '';
                });
            }
            
            redirectToApp(isAuthenticated) {
                // Store auth state for the main app
                sessionStorage.setItem('authMode', isAuthenticated ? 'authenticated' : 'guest');
                
                // Redirect to home page
                window.location.href = 'pages/home.html';
            }
        }
        
        // Initialize landing auth when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new LandingAuth();
        });
        
        // Theme support
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved theme or default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });
    </script>
</body>
</html>